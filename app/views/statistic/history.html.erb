<div class="row">
  <div id="mainStats" class=" stats col-xs-12 col-md-9 ">
    <h3>Preisverlauf</h3>

    <select id="city" size="1">
      <% for city in  ReferenceCities.all() %>
      <option value=<%= city.id %>><%= city.name %></option>
      <% end %>
    </select>

    <canvas id="myChart" width="1000" height="500"></canvas>
  </div>
  
  <div id="sidebar" class="col-xs-12 col-md-3">
       <%= render partial: "sidebarLinks" %>
  </div>
  <div class="clear"></div>
</div>

<script type="text/javascript">

$('#city').change(update);

update();

// This will get the first returned node in the jQuery collection.

var data = {
    labels: [],
    datasets: [
        {
            label: "min Diesel",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: []
        },
        {
            label: "average Diesel",
            fillColor: "rgba(220,220,220,0.2)",
            strokeColor: "rgba(220,220,220,1)",
            pointColor: "rgba(220,220,220,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(220,220,220,1)",
            data: []
        },
        {
            label: "min Super",
            fillColor: "rgba(151,187,205,0.2)",
            strokeColor: "rgba(151,187,205,1)",
            pointColor: "rgba(151,187,205,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: []
        },
        {
            label: "average Super",
            fillColor: "rgba(151,187,205,0.2)",
            strokeColor: "rgba(151,187,205,1)",
            pointColor: "rgba(151,187,205,1)",
            pointStrokeColor: "#fff",
            pointHighlightFill: "#fff",
            pointHighlightStroke: "rgba(151,187,205,1)",
            data: []
        },
    ]
};


/*<% prices = PriceData.where(cityFk: "4") %>
<% for price in prices %>
  data.labels.push('<%= price.updated_at.to_s %>');
  data.datasets[0].data.push(<%= price.averageDiesel %>);
  data.datasets[1].data.push(<%= price.averagePertrol %>);
<% end %>*/
var ctx = $("#myChart").get(0).getContext("2d");
var myLineChart = new Chart(ctx);

myLineChart.Line(data);

//A little later on with new data
function update(e) {
  console.log($('#city').val())
  $.ajax({
  url: "" + $('#city').val(),
  }).done(function(json) 
  {
    console.log(myLineChart);
    //reset dataarrays
    data.labels = [];
    data.datasets[0].data = [];
    data.datasets[1].data = [];
    data.datasets[2].data = [];
    data.datasets[3].data = [];

    for (var i = 0; i < json.length; i++) 
    {
      //console.log(data.datasets[0]);
      data.labels.push(json[i].updated_at)
      data.datasets[0].data.push(json[i].minDiesel);
      data.datasets[1].data.push(json[i].minPetrol);
      data.datasets[2].data.push(json[i].averageDiesel);
      data.datasets[3].data.push(json[i].averagePertrol);

    };


    myLineChart.Line(data);
    ctx.clearRect( 0 , 0 , 1000, 500 );



    

  });


}




</script>


